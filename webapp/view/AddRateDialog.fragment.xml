<core:FragmentDefinition
    xmlns="sap.m"
    xmlns:core="sap.ui.core"
    xmlns:layout="sap.ui.layout"
    xmlns:f="sap.f"
    xmlns:form="sap.ui.layout.form">

    <Dialog
        id="addRateDialog"
        title="Add New Rate Agreement"
        contentWidth="1000px"
        contentHeight="80%"
        resizable="true"
        draggable="true">
        
        <customHeader>
            <Bar design="Header">
                <contentLeft>
                    <VBox>
                        <Title text="Add New Rate Agreement" level="H3"/>
                        <Text text="Configure pricing rules for shipment settlement"/>
                    </VBox>
                </contentLeft>
                <contentRight>
                    <Button icon="sap-icon://decline" press="onCloseAddDialog"/>
                </contentRight>
            </Bar>
        </customHeader>

        <content>
            <ScrollContainer height="100%" width="100%" vertical="true">
                <VBox class="sapUiSmallMargin">

                    <!-- Step 1: Rate Type Selection -->
                    <VBox class="sapUiMediumMarginBottom">
                        <Title text="1ï¸âƒ£ Select Rate Type" level="H4" class="sapUiSmallMarginBottom"/>
                        
                        <FlexBox wrap="Wrap" justifyContent="SpaceBetween">
                            <layout:HorizontalLayout 
                                class="rateTypeCard sapUiTinyMarginEnd sapUiTinyMarginBottom"
                                allowWrapping="false">
                                <Button
                                    icon="sap-icon://customer"
                                    text="Customer Rate"
                                    width="200px"
                                    press="onSelectRateType"
                                    customData>
                                    <core:CustomData key="rateType" value="customer"/>
                                </Button>
                                <VBox class="sapUiTinyMarginTop">
                                    <Text text="Special pricing for specific customers" class="sapUiSmallText"/>
                                </VBox>
                            </layout:HorizontalLayout>

                            <layout:HorizontalLayout 
                                class="rateTypeCard sapUiTinyMarginEnd sapUiTinyMarginBottom"
                                allowWrapping="false">
                                <Button
                                    icon="sap-icon://map-2"
                                    text="Route Rate"
                                    width="200px"
                                    press="onSelectRateType"
                                    customData>
                                    <core:CustomData key="rateType" value="route"/>
                                </Button>
                                <VBox class="sapUiTinyMarginTop">
                                    <Text text="Origin-destination based pricing" class="sapUiSmallText"/>
                                </VBox>
                            </layout:HorizontalLayout>

                            <layout:HorizontalLayout 
                                class="rateTypeCard sapUiTinyMarginEnd sapUiTinyMarginBottom"
                                allowWrapping="false">
                                <Button
                                    icon="sap-icon://supplier"
                                    text="Carrier Contract"
                                    width="200px"
                                    press="onSelectRateType"
                                    customData>
                                    <core:CustomData key="rateType" value="carrier"/>
                                </Button>
                                <VBox class="sapUiTinyMarginTop">
                                    <Text text="External carrier rate agreements" class="sapUiSmallText"/>
                                </VBox>
                            </layout:HorizontalLayout>

                            <layout:HorizontalLayout 
                                class="rateTypeCard sapUiTinyMarginEnd sapUiTinyMarginBottom"
                                allowWrapping="false">
                                <Button
                                    icon="sap-icon://money-bills"
                                    text="Surcharge Rule"
                                    width="200px"
                                    press="onSelectRateType"
                                    customData>
                                    <core:CustomData key="rateType" value="surcharge"/>
                                </Button>
                                <VBox class="sapUiTinyMarginTop">
                                    <Text text="Fuel, peak season, special handling" class="sapUiSmallText"/>
                                </VBox>
                            </layout:HorizontalLayout>
                        </FlexBox>
                    </VBox>

                    <!-- Step 2: Basic Information -->
                    <VBox id="basicInfoSection" visible="false" class="sapUiMediumMarginBottom">
                        <Title text="2ï¸âƒ£ Basic Information" level="H4" class="sapUiSmallMarginBottom"/>
                        
                        <form:SimpleForm
                            editable="true"
                            layout="ResponsiveGridLayout"
                            labelSpanXL="3"
                            labelSpanL="3"
                            labelSpanM="3"
                            labelSpanS="12"
                            adjustLabelSpan="false"
                            emptySpanXL="4"
                            emptySpanL="4"
                            emptySpanM="4"
                            emptySpanS="0"
                            columnsXL="2"
                            columnsL="2"
                            columnsM="1"
                            singleContainerFullSize="false">
                            <form:content>
                                <Label text="Rate Agreement ID" required="true"/>
                                <Input 
                                    id="rateIdInput"
                                    value="{/newRate/id}"
                                    enabled="false"
                                    placeholder="Auto-generated"/>

                                <Label text="Agreement Name" required="true"/>
                                <Input 
                                    id="rateNameInput"
                                    value="{/newRate/name}"
                                    placeholder="e.g., Tech Solutions Premium Rate"/>

                                <Label text="Customer" required="true" id="customerLabel"/>
                                <ComboBox 
                                    id="customerSelect"
                                    selectedKey="{/newRate/customerId}"
                                    placeholder="Select Customer...">
                                    <core:Item key="C-TECH-001" text="Tech Solutions Inc (C-TECH-001)"/>
                                    <core:Item key="C-GLOBAL-001" text="Global Corp (C-GLOBAL-001)"/>
                                    <core:Item key="C-METRO-001" text="Metro Retail (C-METRO-001)"/>
                                    <core:Item key="C-SMART-001" text="Smart Logistics (C-SMART-001)"/>
                                    <core:Item key="C-INNO-001" text="Innovation Labs (C-INNO-001)"/>
                                </ComboBox>

                                <Label text="Carrier" required="true" id="carrierLabel" visible="false"/>
                                <ComboBox 
                                    id="carrierSelect"
                                    selectedKey="{/newRate/carrierId}"
                                    visible="false"
                                    placeholder="Select Carrier...">
                                    <core:Item key="DHL" text="DHL Express Thailand"/>
                                    <core:Item key="FEDEX" text="FedEx Thailand"/>
                                    <core:Item key="KERRY" text="Kerry Logistics"/>
                                    <core:Item key="TNT" text="TNT Express"/>
                                    <core:Item key="FLASH" text="Flash Express"/>
                                </ComboBox>

                                <Label text="Valid From" required="true"/>
                                <DatePicker 
                                    id="validFromDate"
                                    value="{/newRate/validFrom}"
                                    displayFormat="yyyy-MM-dd"/>

                                <Label text="Valid To" required="true"/>
                                <DatePicker 
                                    id="validToDate"
                                    value="{/newRate/validTo}"
                                    displayFormat="yyyy-MM-dd"/>

                                <Label text="Currency"/>
                                <ComboBox 
                                    selectedKey="{/newRate/currency}">
                                    <core:Item key="THB" text="THB - Thai Baht"/>
                                    <core:Item key="USD" text="USD - US Dollar"/>
                                    <core:Item key="EUR" text="EUR - Euro"/>
                                </ComboBox>

                                <Label text="Status"/>
                                <ComboBox 
                                    selectedKey="{/newRate/status}">
                                    <core:Item key="DRAFT" text="ðŸ“ Draft"/>
                                    <core:Item key="ACTIVE" text="âœ… Active"/>
                                    <core:Item key="PENDING_APPROVAL" text="â³ Pending Approval"/>
                                </ComboBox>
                            </form:content>
                        </form:SimpleForm>
                    </VBox>

                    <!-- Step 2B: Route Configuration -->
                    <VBox id="routeSection" visible="false" class="sapUiMediumMarginBottom">
                        <Title text="ðŸ›£ï¸ Route Configuration" level="H4" class="sapUiSmallMarginBottom"/>
                        
                        <form:SimpleForm
                            editable="true"
                            layout="ResponsiveGridLayout"
                            labelSpanXL="3"
                            labelSpanL="3"
                            labelSpanM="3"
                            labelSpanS="12"
                            columnsXL="2"
                            columnsL="2"
                            columnsM="1">
                            <form:content>
                                <Label text="Origin Zone / Location" required="true"/>
                                <ComboBox 
                                    selectedKey="{/newRate/originZone}"
                                    placeholder="Select Origin...">
                                    <core:Item key="BKK" text="Bangkok Metro"/>
                                    <core:Item key="CNX" text="Chiang Mai"/>
                                    <core:Item key="HKT" text="Phuket"/>
                                    <core:Item key="KKN" text="Khon Kaen"/>
                                    <core:Item key="RYG" text="Rayong"/>
                                    <core:Item key="CENTRAL" text="Central Region"/>
                                    <core:Item key="NORTH" text="Northern Region"/>
                                    <core:Item key="SOUTH" text="Southern Region"/>
                                    <core:Item key="NORTHEAST" text="Northeastern Region"/>
                                </ComboBox>

                                <Label text="Destination Zone / Location" required="true"/>
                                <ComboBox 
                                    selectedKey="{/newRate/destZone}"
                                    placeholder="Select Destination...">
                                    <core:Item key="BKK" text="Bangkok Metro"/>
                                    <core:Item key="CNX" text="Chiang Mai"/>
                                    <core:Item key="HKT" text="Phuket"/>
                                    <core:Item key="KKN" text="Khon Kaen"/>
                                    <core:Item key="RYG" text="Rayong"/>
                                    <core:Item key="CENTRAL" text="Central Region"/>
                                    <core:Item key="NORTH" text="Northern Region"/>
                                    <core:Item key="SOUTH" text="Southern Region"/>
                                    <core:Item key="NORTHEAST" text="Northeastern Region"/>
                                </ComboBox>

                                <Label text="Route Description"/>
                                <Input 
                                    value="{/newRate/routeDescription}"
                                    placeholder="e.g., Bangkok to Chiang Mai - Main Highway Route"/>
                            </form:content>
                        </form:SimpleForm>
                    </VBox>

                    <!-- Step 3: Base Pricing -->
                    <VBox id="pricingSection" visible="false" class="sapUiMediumMarginBottom">
                        <Title text="3ï¸âƒ£ Base Pricing Configuration" level="H4" class="sapUiSmallMarginBottom"/>
                        
                        <MessageStrip 
                            text="Pricing Formula: Total = (Distance Ã— Rate/km) + (Weight Ã— Rate/kg) + Surcharges - Discounts"
                            type="Information"
                            showIcon="true"
                            class="sapUiSmallMarginBottom"/>
                        
                        <form:SimpleForm
                            editable="true"
                            layout="ResponsiveGridLayout"
                            labelSpanXL="3"
                            labelSpanL="3"
                            labelSpanM="3"
                            labelSpanS="12"
                            columnsXL="3"
                            columnsL="3"
                            columnsM="2">
                            <form:content>
                                <Label text="Base Rate per KM" required="true"/>
                                <Input 
                                    value="{/newRate/baseKm}"
                                    type="Number"
                                    placeholder="0.00"
                                    description="à¸¿/km"/>

                                <Label text="Weight Rate per KG" required="true"/>
                                <Input 
                                    value="{/newRate/weightKg}"
                                    type="Number"
                                    placeholder="0.00"
                                    description="à¸¿/kg"/>

                                <Label text="Minimum Charge"/>
                                <Input 
                                    value="{/newRate/minCharge}"
                                    type="Number"
                                    placeholder="0.00"
                                    description="à¸¿"/>
                            </form:content>
                        </form:SimpleForm>
                    </VBox>

                    <!-- Step 4: Surcharges & Discounts -->
                    <VBox id="surchargesSection" visible="false" class="sapUiMediumMarginBottom">
                        <Title text="4ï¸âƒ£ Surcharges & Discounts" level="H4" class="sapUiSmallMarginBottom"/>
                        
                        <form:SimpleForm
                            editable="true"
                            layout="ResponsiveGridLayout"
                            labelSpanXL="3"
                            labelSpanL="3"
                            labelSpanM="3"
                            labelSpanS="12"
                            columnsXL="3"
                            columnsL="3"
                            columnsM="2">
                            <form:content>
                                <Label text="Fuel Surcharge %"/>
                                <Input 
                                    value="{/newRate/fuel}"
                                    type="Number"
                                    placeholder="0.00"
                                    description="%"/>

                                <Label text="Customer Discount %"/>
                                <Input 
                                    value="{/newRate/discount}"
                                    type="Number"
                                    placeholder="0.00"
                                    description="%"/>

                                <Label text="Markup % (for External)"/>
                                <Input 
                                    value="{/newRate/markup}"
                                    type="Number"
                                    placeholder="0.00"
                                    description="%"/>
                            </form:content>
                        </form:SimpleForm>
                    </VBox>

                    <!-- Step 5: Service Types -->
                    <VBox id="serviceTypesSection" visible="false" class="sapUiMediumMarginBottom">
                        <Title text="5ï¸âƒ£ Applicable Service Types" level="H4" class="sapUiSmallMarginBottom"/>
                        
                        <FlexBox wrap="Wrap">
                            <CheckBox text="Standard Freight" selected="true" class="sapUiTinyMarginEnd sapUiTinyMarginBottom"/>
                            <CheckBox text="Express Delivery" selected="true" class="sapUiTinyMarginEnd sapUiTinyMarginBottom"/>
                            <CheckBox text="Same Day" class="sapUiTinyMarginEnd sapUiTinyMarginBottom"/>
                            <CheckBox text="Cold Chain" class="sapUiTinyMarginEnd sapUiTinyMarginBottom"/>
                            <CheckBox text="Dangerous Goods" class="sapUiTinyMarginEnd sapUiTinyMarginBottom"/>
                            <CheckBox text="White Glove" class="sapUiTinyMarginEnd sapUiTinyMarginBottom"/>
                        </FlexBox>
                    </VBox>

                    <!-- Step 6: Notes -->
                    <VBox id="notesSection" visible="false" class="sapUiMediumMarginBottom">
                        <Title text="ðŸ“ Notes & Terms" level="H4" class="sapUiSmallMarginBottom"/>
                        
                        <VBox>
                            <Label text="Internal Notes"/>
                            <TextArea 
                                value="{/newRate/notes}"
                                rows="4"
                                placeholder="Add any internal notes about this rate agreement..."/>
                        </VBox>

                        <VBox class="sapUiSmallMarginTop">
                            <Label text="Terms & Conditions Reference"/>
                            <Input 
                                value="{/newRate/termsRef}"
                                placeholder="e.g., Contract Ref: CT-2026-001234"/>
                        </VBox>
                    </VBox>

                </VBox>
            </ScrollContainer>
        </content>

        <beginButton>
            <Button text="Save as Draft" icon="sap-icon://save" press="onSaveAsDraft"/>
        </beginButton>
        <endButton>
            <Button text="Save & Activate" type="Emphasized" icon="sap-icon://accept" press="onSaveAndActivate"/>
        </endButton>
    </Dialog>

</core:FragmentDefinition>