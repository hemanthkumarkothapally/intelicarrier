<core:FragmentDefinition xmlns="sap.m"
    xmlns:core="sap.ui.core"
    xmlns:u="sap.ui.unified"
    xmlns:f="sap.ui.layout.form"
    xmlns:upload="sap.ui.unified.FileUploader">

    <VBox id="addNewEFP">

        <VBox >

            <HBox width="100%" justifyContent="SpaceBetween">
                <HBox >
                    <Button id="newBtnBack" icon="sap-icon://nav-back" type="Transparent" press="_showView('addNewexpenseFuelParkingManagement')" />
                    <Title text="Expense Entry — Shipment 8062137294" level="H1" class="sapUiSmallMarginBegin" />
                </HBox>
                <ToolbarSpacer ></ToolbarSpacer>
                <HBox gap="10px">
                    <Button text="Print"></Button>
                    <Button text="Submit for Manager Review"></Button>
                </HBox>

            </HBox>

            <HBox >
                <Text text="BU: 060C Atlas-LPG-BPK  |  Route: C395 BPK → PTT TANK → บ่อวิน  |  Driver: นายศักดิ์ทวดส จินตาพืช (39396)  |  Vehicle: 71-5432"></Text>

            </HBox>


        </VBox>
        <HBox justifyContent="SpaceBetween" alignItems="Center" class="sapUiSmallMarginTop sapUiMediumPadding" backgroundDesign="Translucent">

            <HBox>

                <Text text="Cash Advance: CA-2026-0045 (Driver)  |  Amount: ฿5,000  |  Expenses: ฿1,550  |  Balance: ฿3,450" wrapping="true" />
            </HBox>

            <HBox>
                <Button text="Settlement" type="Emphasized" class="sapUiTinyMarginEnd" press="_showView('settlementReconciliation')" />


            </HBox>
        </HBox>


        <Panel id="expenseEntryPanel" width="100%" class="sapUiMediumMargin" expandable="false">

            <!-- ================= TAB BAR ================= -->
            <IconTabBar expandable="false" class="sapUiResponsiveContentPadding">

                <items>


                    <IconTabFilter key="EXPENSE" text="Expense (4)">


                        <MessageStrip type="Warning" showIcon="true" class="sapUiSmallMarginBottom" text="บันทึกแล้ว Add ต่อได้เลย ไม่ต้องกดจบ · ระบบ Auto กลุ่มค่าใช้จ่าย จาก หน่วยงาน + ประเภทค่าใช้จ่าย · Credit ให้ใส่ Vendor ด้วย" />

                        <!-- Section Title -->
                        <Title text="New Expense Entry" level="H4" class="sapUiSmallMarginBottom" />


                        <f:SimpleForm xmlns:f="sap.ui.layout.form" layout="ColumnLayout" editable="true">

                            <!-- BU -->
                            <Label text="หน่วยงาน (BU)" required="true" />

                            <Select selectedKey="060C">
                                <items>
                                    <core:Item key="060C" text="060C Atlas-LPG-BPK" />
                                    <core:Item key="060E" text="060E Atlas-LPG-NKC" />
                                    <core:Item key="060F" text="060F RY Chemical" />
                                    <core:Item key="0609" text="0609 SC Carrier BRP" />
                                    <core:Item key="060A" text="060A SC Carrier SRC" />
                                </items>
                            </Select>

                            <!-- Shipment -->
                            <Label text="Shipment No." />
                            <Input value="{expenceDataModel>/expense/shipmentNo}" editable="false" />

                            <!-- Date -->
                            <Label text="วันที่" required="true" />
                            <DateTimePicker value="{expenceDataModel>/expense/date}" displayFormat="dd/MM/yyyy hh:mm a" valueFormat="yyyy-MM-dd'T'HH:mm:ss" />

                            <!-- Ref Doc -->
                            <Label text="Ref. Doc (เลขใบเสร็จ)" />
                            <Input value="{expenceDataModel>/expense/refDoc}" placeholder="กรอกเลขที่ใบเสร็จ" />

                            <!-- Employee -->
                            <Label text="พขร / Employee" required="true" />
                            <Select selectedKey="{expenceDataModel>/expense/employee}">
                                <items>
                                    <core:Item xmlns:core="sap.ui.core" key="39396" text="39396 — นายศักดิ์ทิวาดล จินดาพิชัย" />
                                </items>
                            </Select>

                            <!-- Expense Type -->
                            <Label text="ประเภทค่าใช้จ่าย" required="true" />
                            <Select selectedKey="">
                                <items>
                                    <core:Item key="" text="— เลือกประเภท —" />
                                    <core:Item key="TOLL" text="ค่าทางด่วน (Toll)" />
                                    <core:Item key="MEAL" text="ค่าอาหาร (Meal)" />
                                    <core:Item key="OVERNIGHT" text="ค่าค้างคืน (Overnight)" />
                                    <core:Item key="WEIGH" text="ค่าน้ำหนัก (Weighbridge)" />
                                    <core:Item key="PORT" text="ค่าผ่านท่า (Port Fee)" />
                                    <core:Item key="EMERGENCY" text="ค่าซ่อมฉุกเฉิน (Emergency Repair)" />
                                    <core:Item key="FINE" text="ค่าปรับ (Fine/Penalty)" />
                                    <core:Item key="OTHER" text="อื่นๆ (Other)" />
                                </items>
                            </Select>

                            <!-- Cost Group -->
                            <Label text="กลุ่มค่าใช้จ่าย" />
                            <Input value="{expenceDataModel>/expense/costGroup}" editable="false" />

                            <!-- Amount -->
                            <Label text="จำนวนเงิน" required="true" />
                            <Input type="Number" value="{expenceDataModel>/expense/amount}" />

                            <!-- Payment Type -->
                            <Label text="ประเภทรายจ่าย" required="true" />
                            <Select selectedKey="{expenceDataModel>/expense/paymentType}">
                                <items>
                                    <core:Item xmlns:core="sap.ui.core" key="CASH" text="Cash (เงินสด)" />
                                    <core:Item key="CREDIT" text="Credit" />
                                </items>
                            </Select>

                            <!-- Vendor -->
                            <Label text="Vendor" />
                            <Select selectedKey="">
                                <items>
                                    <core:Item xmlns:core="sap.ui.core" key="" text="— Select Vendor —" />

                                    <core:Item key="V001" text="V001 — Shell Thailand" />
                                    <core:Item key="V002" text="V002 — PTT Station" />
                                    <core:Item key="V003" text="V003 — Bangchak" />
                                    <core:Item key="V004" text="V004 — Caltex" />
                                    <core:Item key="V005" text="V005 — Esso" />
                                    <core:Item key="V006" text="V006 — ร้านอาหารริมทาง" />
                                    <core:Item key="V007" text="V007 — ทางพิเศษแห่งประเทศไทย" />
                                    <core:Item key="V008" text="V008 — การทางพิเศษ (EXAT)" />
                                </items>
                            </Select>

                            <!-- Cash Advance Ref -->
                            <Label text="Cash Advance Ref" />
                            <Select selectedKey="CA">
                                <items>
                                    <core:Item key="060E" text="060E Atlas-LPG-NKC" />
                                    <core:Item key="CA" text="CA-2026-0045(Balance:3,500)" />

                                </items>
                            </Select>

                            <!-- Remarks -->
                            <Label text="หมายเหตุ" />
                            <Input value="{expenceDataModel>/expense/remarks}" placeholder="Optional remarks..." />


                            <Label text="หลักฐานการใช้จ่าย (Receipt)" />
                            <u:FileUploader id="upsettlementFileUploader" width="100%" placeholder="Upload transfer slip / invoice" fileType="pdf,jpg,png" multiple="true" uploadOnChange="false" />


                        </f:SimpleForm>





                        <HBox justifyContent="End" class="sapUiMediumMarginTop">
                            <Button text="Save &amp; Add Another" icon="sap-icon://save" type="Emphasized" class="sapUiSmallMarginBottom" press="onSaveAndAddAnother" />
                        </HBox>

                        <MessageStrip type="Warning" showIcon="true" class="sapUiSmallMarginBottom" text="
ค่าใช้จ่ายออกแทน
— จ่ายแทนหน่วยงานอื่น จะแยกตารางออกไป (หน่วยงาน + ประเภทค่าใช้จ่าย)" />


                        <Table id="recordedExpensesTable" items="{expenceDataModel>/recordedExpenses}" inset="false" class="sapUiMediumMarginTop">

                            <headerToolbar>
                                <Toolbar>
                                    <Title text="Recorded Expenses" level="H4" />
                                </Toolbar>
                            </headerToolbar>

                            <columns>
                                <Column>
                                    <Text text="#" />
                                </Column>
                                <Column>
                                    <Text text="Date" />
                                </Column>
                                <Column>
                                    <Text text="Ref Doc" />
                                </Column>
                                <Column>
                                    <Text text="Employee" />
                                </Column>
                                <Column>
                                    <Text text="Type" />
                                </Column>
                                <Column>
                                    <Text text="Group" />
                                </Column>
                                <Column>
                                    <Text text="Pay" />
                                </Column>
                                <Column hAlign="End">
                                    <Text text="Amount" />
                                </Column>
                                <Column hAlign="Center">
                                    <Text text="Receipt" />
                                </Column>
                                <Column>
                                    <Text text="Status" />
                                </Column>
                                <Column hAlign="Center">
                                    <Text text="Action" />
                                </Column>
                            </columns>

                            <items>
                                <ColumnListItem type="Inactive" class="{= ${expenceDataModel>status} === 'Rejected' ? 'sapUiTableRowHighlightError' : '' }">

                                    <cells>

                                        <Text text="{expenceDataModel>no}" />
                                        <Text text="{expenceDataModel>date}" />
                                        <Text text="{expenceDataModel>refDoc}" />
                                        <Text text="{expenceDataModel>employee}" />
                                        <Text text="{expenceDataModel>type}" />
                                        <Text text="{expenceDataModel>group}" />

                                        <!-- Pay -->
                                        <ObjectStatus text="{expenceDataModel>payType}" state="Success" />

                                        <!-- Amount -->
                                        <Text text="฿{expenceDataModel>amount}" class="sapUiBold" />

                                        <!-- Receipt -->
                                        <Text text="฿{expenceDataModel>receipt}" class="sapUiBold" />

                                        <!-- Status -->
                                        <VBox>
                                            <ObjectStatus text="{expenceDataModel>status}" state="{expenceDataModel>statusState}" />
                                            <Text text="{expenceDataModel>remark}" visible="{= ${expenceDataModel>status} === 'Rejected' }" class="sapUiTinyMarginTop sapUiTextNegative" />
                                        </VBox>

                                        <!-- Action -->
                                        <HBox justifyContent="Center">
                                            <Button icon="sap-icon://edit" type="Transparent" press="onEditExpense" />
                                            <Button icon="sap-icon://decline" type="Transparent" press="onDeleteExpense" />
                                        </HBox>

                                    </cells>
                                </ColumnListItem>
                            </items>

                        </Table>

                        <!-- TOTAL -->
                        <HBox justifyContent="End" class="sapUiSmallMarginTop sapUiMediumPadding">

                            <Text text="Total:" class="sapUiSmallMarginEnd sapUiBold" />
                            <Text text="฿{expenceDataModel>/totalAmount}" class="sapUiBold sapUiTextLarge" />
                        </HBox>



                    </IconTabFilter>

                    <!-- Other tabs placeholders -->
                    <IconTabFilter text="Fuel (2)" >

                          <MessageStrip type="Warning" showIcon="true" class="sapUiSmallMarginBottom" text=" เติม 1 ครั้ง = 1 record • บันทึกหลาย Shipment ได้ (Shared) → auto share ตามระยะทาง • พขร ถ่ายรูปใบเสร็จ → OCR auto-fill • ระบบ auto เพิ่มข้อมูลบัตร Fleet Card จากทะเบียนรถ" />

                           <HBox class="sapUiSmallMarginBottom">
        <Button text="Fleet Card" type="Emphasized" icon="sap-icon://credit-card" />
        <Button text="Store Fuel" type="Transparent" class="sapUiTinyMarginBegin" />
        <Button text="Cash" type="Transparent" class="sapUiTinyMarginBegin" />
    </HBox>

    <!-- Fleet Card Info -->
    <Panel
        backgroundDesign="Transparent"
        class="sapUiSmallMarginBottom">

        <HBox justifyContent="SpaceBetween" alignItems="Center">

            <HBox>
                <VBox class="sapUiSmallMarginEnd">
                    <Text text="FLEET CARD"  />
                    <Text text="4532-XXXX-XXXX-8801" class="sapUiTextLink" />
                </VBox>

                <VBox class="sapUiSmallMarginEnd">
                    <Text text="VEHICLE" />
                    <Text text="71-5432" />
                </VBox>

                <VBox class="sapUiSmallMarginEnd">
                    <Text text="STATUS"  />
                    <ObjectStatus text="Active" state="Success" />
                </VBox>

                <VBox class="sapUiSmallMarginEnd">
                    <Text text="MONTHLY LIMIT"  />
                    <Text text="฿50,000" />
                </VBox>

                <VBox>
                    <Text text="USED"  />
                    <Text text="฿17,167" />
                </VBox>
            </HBox>

            <Text
                text="Auto-fill from plate · ถ้าไม่ตรง → พขร แก้ไขเอง → Admin แก้ไข"
                class="sapUiTinyMarginEnd" />
        </HBox>
    </Panel>

    <!-- New Fuel Entry -->
    <Title text="New Fuel Entry" level="H4" class="sapUiSmallMarginBottom" />

    <f:SimpleForm
        xmlns:f="sap.ui.layout.form"
        xmlns:core="sap.ui.core"
        layout="ColumnLayout"
        editable="true">

        <!-- Date -->
        <Label text="วันเวลาเติม" required="true" />
        <DateTimePicker
            value="02/02/2026 06:30 AM"
            displayFormat="dd/MM/yyyy hh:mm a" />

        <!-- Fuel Type -->
        <Label text="ประเภทการเติม" required="true" />
        <Select selectedKey="FLEET">
            <items>
                <core:Item key="FLEET" text="Fleet Card" />
                <core:Item key="STORE" text="Store Fuel" />
                <core:Item key="CASH" text="Cash" />
            </items>
        </Select>

        <!-- BU -->
        <Label text="หน่วยงาน" />
        <Input value="060C Atlas-LPG-BPK" editable="false" />

        <!-- Vehicle -->
        <Label text="ทะเบียนรถ" />
        <Input value="71-5432" editable="false" />

        <!-- Driver -->
        <Label text="ผู้เติม" required="true" />
        <Select selectedKey="39396">
            <items>
                <core:Item
                    key="39396"
                    text="39396 — นายศักดิ์ทิวาดล จินดาพิชัย" />
            </items>
        </Select>

        <!-- Fleet No -->
        <Label text="สลิปเลข" />
        <Input value="FL-XXXXX" />

        <!-- Receipt No -->
        <Label text="เลขใบต่อเติม" />
        <Input />

        <!-- Station -->
        <Label text="ปั๊ม / Store" required="true" />
        <Select>
            <items>
                <core:Item key="" text="— Select —" />
            </items>
        </Select>

        <!-- Fuel Type -->
        <Label text="ประเภทน้ำมัน" required="true" />
        <Select selectedKey="DIESEL">
            <items>
                <core:Item key="DIESEL" text="Diesel B7" />
            </items>
        </Select>

        <!-- Liter -->
        <Label text="จำนวนลิตร" required="true" />
        <Input type="Number" value="0.00" />

        <!-- Amount -->
        <Label text="จำนวนเงิน" required="true" />
        <Input type="Number" value="0.00" />

        <!-- Consumption Rate -->
        <Label text="Consumption Rate" />
        <Input value="4.10" editable="false" />
        <Text text="From ZLSDE01_T040" />

        <!-- Shared -->
        <Label text="Shared Across Shipments?" />
        <Select selectedKey="NO">
            <items>
                <core:Item key="NO" text="No — This shipment only" />
                <core:Item key="YES" text="Yes — Share across shipments" />
            </items>
        </Select>

        <!-- GPS -->
        <Label text="GPS Location" />
        <Input value="13.7563, 100.5018" editable="false" />
        <Text text="lat/long เก็บจากมือถือ" />

         <Label text="หลักฐานการใช้จ่าย (Receipt)" />
                            <u:FileUploader id="uppsettlementFileUploader" width="100%" placeholder="Upload transfer slip / invoice" fileType="pdf,jpg,png" multiple="true" uploadOnChange="false" />



    </f:SimpleForm>

      <HBox justifyContent="End" class="sapUiMediumMarginTop">
                            <Button text="Save Fuel Entry" icon="sap-icon://save" type="Emphasized" class="sapUiSmallMarginBottom" press="onSaveAndAddAnother" />
                        </HBox>

                        <Table
    id="fuelRecordsTable"
    items="{expenceDataModel>/fuelRecordss}"
    class="sapUiMediumMarginBottom">

    <headerToolbar>
        <Toolbar>
            <Title text="Fuel Records" level="H4" />
        </Toolbar>
    </headerToolbar>

    <columns>
        <Column><Text text="#" /></Column>
        <Column><Text text="Date" /></Column>
        <Column><Text text="Fill Type" /></Column>
        <Column><Text text="Slip" /></Column>
        <Column><Text text="Station" /></Column>
        <Column><Text text="Fuel" /></Column>
        <Column hAlign="End"><Text text="Liters" /></Column>
        <Column hAlign="End"><Text text="Amount" /></Column>
        <Column><Text text="Rate" /></Column>
        <Column><Text text="Status" /></Column>
        <Column hAlign="Center"><Text text="Action" /></Column>
    </columns>

    <items>
        <ColumnListItem>
            <cells>
                <Text text="{expenceDataModel>no}" />
                <Text text="{expenceDataModel>date}" />

                <ObjectStatus
                    text="{expenceDataModel>fillType}"
                    state="{expenceDataModel>fillState}" />

                <Text text="{expenceDataModel>slip}" />
                <Text text="{expenceDataModel>station}" />
                <Text text="{expenceDataModel>fuel}" />
                <Text text="{expenceDataModel>liters}" />
                <Text text="฿{expenceDataModel>amount}" />
                <Text text="{expenceDataModel>rate}" />

                <ObjectStatus
                    text="{expenceDataModel>status}"
                    state="{expenceDataModel>statusState}" />

                <Button
                    icon="sap-icon://edit"
                    type="Transparent" />
            </cells>
        </ColumnListItem>
    </items>
</Table>

<!-- Totals -->
<HBox justifyContent="End" class="sapUiMediumPadding" >
    <Text text="Total:" class="sapUiSmallMarginEnd sapUiBold" />
    <Text
        text="{expenceDataModel>/totalLiters} L"
        class="sapUiSmallMarginEnd sapUiBold" />
    <Text
        text="฿{expenceDataModel>/TotalAmount}"
        class="sapUiBold sapUiTextLarge" />
</HBox>

<Title
    text="Fuel Allocation per Stage"
    level="H4"
    class="sapUiMediumMarginTop" />

<MessageStrip
    type="Information"
    showIcon="true"
    text="แชร์น้ำมันตามระยะทางจริง · เก็บ reference เติมในแต่ละ stage · เก็บทศนิยม 4 ตำแหน่ง แสดง 2"
    class="sapUiSmallMarginBottom" />

<Table
    id="fuelAllocationTable"
    items="{expenceDataModel>/fuelAllocation}">

    <columns>
        <Column><Text text="Stage" /></Column>
        <Column><Text text="From" /></Column>
        <Column><Text text="To" /></Column>
        <Column hAlign="End"><Text text="Start Miles" /></Column>
        <Column hAlign="End"><Text text="End Miles" /></Column>
        <Column hAlign="End"><Text text="Distance" /></Column>
        <Column hAlign="End"><Text text="Ratio" /></Column>
        <Column hAlign="End"><Text text="Fuel (L)" /></Column>
        <Column hAlign="End"><Text text="Cost (฿)" /></Column>
    </columns>

    <items>
        <ColumnListItem>
            <cells>
                <Text text="{expenceDataModel>stage}" />

                <VBox>
                    <Text text="{expenceDataModel>from}" />
                    <Text
                        text="{expenceDataModel>fromDesc}"
                        class="sapUiTinyText" />
                </VBox>

                <VBox>
                    <Text text="{expenceDataModel>to}" />
                    <Text
                        text="{expenceDataModel>toDesc}"
                        class="sapUiTinyText" />
                </VBox>

                <Text text="{expenceDataModel>startMiles}" />
                <Text text="{expenceDataModel>endMiles}" />
                <Text text="{expenceDataModel>distance}" />
                <Text text="{expenceDataModel>ratio}" />
                <Text text="{expenceDataModel>fuel}" />
                <Text text="฿{expenceDataModel>cost}" />
            </cells>
        </ColumnListItem>
    </items>
</Table>

<!-- Allocation Totals -->
<!-- Fuel Allocation Footer -->
<HBox
    width="100%"
    class="sapUiMediumPadding"
   >

    <!-- Stage -->
    <HBox width="6%" />

    <!-- From (COUNT HERE) -->
    <HBox width="18%">
        <Text
            text="Count: 3"
            class="sapUiBold" />
    </HBox>

    <!-- To -->
    <HBox width="18%" />

    <!-- Start Miles -->
    <HBox width="10%" />

    <!-- End Miles -->
    <HBox width="10%" />

    <!-- Distance -->
    <HBox width="10%" justifyContent="End">
        <Text text="259" class="sapUiBold" />
    </HBox>

    <!-- Ratio -->
    <HBox width="8%" justifyContent="End">
        <Text text="100%" class="sapUiBold" />
    </HBox>

    <!-- Fuel -->
    <HBox width="10%" justifyContent="Center">
        <Text text="180.5" class="sapUiBold" />
    </HBox>

    <!-- Cost -->
    <HBox width="10%" justifyContent="End">
        <Text
            text="฿5,584.67"
            class="sapUiBold sapUiTextLarge" />
    </HBox>
</HBox>







                     </IconTabFilter>
                    <IconTabFilter text="Parking (2)" >

                     </IconTabFilter>
                    <IconTabFilter text="Summary">

                     </IconTabFilter>

                </items>
            </IconTabBar>

        </Panel>




    </VBox>

</core:FragmentDefinition>
